/*!
 * Melisa Sencha
 * Copyright (c) 2017 Melisa Company
 * 2018-01-10 10:01:52
 */
Ext.define("Melisa.override.menu.Item",{override:"Ext.menu.Item",config:{melisa:null},publishes:["melisa"]}),Ext.define("Melisa.override.Button",{override:"Ext.Button",config:{melisa:null,record:null},publishes:["melisa","record"]}),Ext.define("Melisa.override.form.Panel",{override:"Ext.form.Panel",bodyPadding:15}),Ext.define("Melisa.override.form.field.Text",{override:"Ext.form.field.Text",labelAlign:"top",config:{melisa:null},publishes:["melisa"]}),Ext.define("Melisa.override.form.field.ComboBox",{override:"Ext.form.field.ComboBox",config:{melisa:null,displayField:"name",valueField:"id",pageSize:25,minChars:1},publishes:["melisa"],constructor:function(){var a=this;a.callParent(arguments),a.listConfig=Ext.applyIf(a.listConfig||{cls:"x-grid-empty"},{cls:"x-grid-empty",emptyText:"Dato no encontrado"})}}),Ext.define("Melisa.override.form.field.Checkbox",{override:"Ext.form.field.Checkbox",labelAlign:"top",uncheckedValue:0,inputValue:1,config:{melisa:null},publishes:["melisa"]}),Ext.define("Melisa.override.form.field.DateField",{override:"Ext.form.field.Date",config:{submitFormat:"Y-m-d"}}),Ext.define("Melisa.override.form.field.Number",{override:"Ext.form.field.Number",decimalSeparator:"."}),Ext.define("Melisa.override.grid.column.Widget",{override:"Ext.grid.column.Widget",sortable:!1,menuDisabled:!0,resizable:!1}),Ext.define("Melisa.override.grid.column.Boolean",{override:"Ext.grid.column.Boolean",trueText:"Si",falseText:"No"}),Ext.define("Melisa.override.window.Window",{override:"Ext.window.Window",bodyPadding:"15 12",onEsc:function(a){console.log("entro"),a.stopEvent()}}),Ext.define("Melisa.util.Format",{override:"Ext.util.Format"}),Ext.onReady(function(){Ext.apply(Ext.util.Format,{decimalSeparator:".",thousandSeparator:","}),Ext.Date.patterns={ISO8601Long:"Y-m-d H:i:s",ISO8601Short:"Y-m-d",ShortDate:"n/j/Y",LongDate:"l, F d, Y",FullDateTime:"l, F d, Y g:i:s A",MonthDay:"F d",ShortTime:"g:i A",LongTime:"g:i:s A",SortableDateTime:"Y-m-d\\TH:i:s",UniversalSortableDateTime:"Y-m-d H:i:sO",YearMonth:"F, Y"}}),Ext.define("Melisa.override.ux.Iframe",{override:"Ext.ux.IFrame",config:{src:"about:blank"},publishes:["src"],setSrc:function(a){var b=this;b.src=a,b.isVisible()&&b.load(a)}}),Ext.define("Melisa.core.Logger",{singleton:!0,config:{logger:null,debug:!1},constructor:function(){var a=this,b=Ext.manifest.melisa;a.setDebug(b.debug)},log:function(){var a=this,b=a.getLogger(),c=arguments;return console&&a.getDebug()?b?(b.log.call(a,c),a):void console.log.apply(console,c):a}}),Ext.define("Melisa.ux.Loader",{singleton:!0,constructor:function(){this.destroy()},destroy:function(){var a=Ext.get("loader");a&&setTimeout(function(){a.addCls("fadeOut"),setTimeout(function(){a.destroy()},1e3)},1)}}),Ext.define("Melisa.core.Base",{requires:["Melisa.core.Logger"],log:function(){var a=Array.prototype.slice.call(arguments);return a.unshift(Ext.ClassManager.getName(this)+" -> "),Melisa.core.Logger.log.apply(Melisa.core.Logger,a)}}),Ext.define("Melisa.core.Menus",{requires:["Melisa.core.Base"],mixins:["Melisa.core.Base"],config:{sourceChildren:"items",propertyChildren:"items"},build:function(a,b){return this.createStructMenu(a,b)},getOptionDefault:function(a){return Ext.applyIf(a||{},{})},createStructMenu:function(a,b){var c=this,d=[],e=c.getSourceChildren(),f=c.getPropertyChildren();return Array.isArray(a)||(a=[a]),c.log("before create struct menu",a),Ext.each(a,function(a){return"undefined"!=typeof a[e]&&a[e].length>0?(c.createStructOption(a,b),a[f]=c.createStructMenu(a[e],b),f!==e&&delete a[e],Ext.isEmpty(a[f])?(c.log("Menu without privileged options",a),!0):(d.push(a),!0)):(c.createStructOption(a,b),"undefined"==typeof a.module||a.module.allowed?void d.push(a):(c.log("ignore option is not allowed",a),!0))}),c.log("created struct menu",d),d},createStructOption:function(a,b){}}),Ext.define("Melisa.core.menus.Tree",{extend:"Melisa.core.Menus",requires:["Melisa.core.Menus"],singleton:!0,config:{propertyChildren:"children",autoExpandChildrens:!0,iconScale:"small"},constructor:function(){this.initConfig(arguments)},createStructOption:function(a,b){var c=this,d=c.getSourceChildren(),e=c.getAutoExpandChildrens(),f=c.getIconScale();"undefined"!=typeof a[d]&&a[d].length>0?a.expanded=e:a.leaf=!0,a.iconCls=a.icon[f],a.qtip=a.name,delete a.icon}}),Ext.define("Melisa.core.AutoOpenModule",{requires:["Melisa.core.Base"],mixins:["Melisa.core.Base"],singleton:!0,config:{vento:null,store:null},constructor:function(){var a=this,b=Ext.GlobalEvents,c=new Ext.util.LocalStorage({id:"native"}),d=c.getItem("notificacion");a.setStore(c),b.on({autoopenmodule:a.onAutoOpen,instancecreate:a.onInstanceCreate,rebootmodule:a.onInstanceCreate,scope:a}),d&&c.removeItem("notificacion"),a.onAutoOpen(d)},onAutoOpen:function(a){var b,c=this,d=Ext.GlobalEvents;return a?(b=Ext.decode(a,!0))?(c.log("Evento recibido",b),c.setEvento(b),void d.fireEvent("loadermodule",b.modulo)):void c.log("Evento mal formato se recibio",a):void c.log("No se especifico evento")},onInstanceCreate:function(a,b){var c=this,d=c.getEvento();return d?d.modulo.ns!==a?void c.log("El nombre de espacio no es el esperado",a):(c.setEvento(null),d.fireEvent?void b.getWrapper().fireEvent(d.fireEvent,d.params,d):void c.log("No se especifico evento",d)):void c.log("No se ha definido un evento")}}),Ext.define("Melisa.core.ProfileDesktop",{extend:"Ext.app.Profile",view:null,isActive:function(){return Ext.platformTags.desktop&&Ext.platformTags.classic},launch:function(){Ext.require(this.view,function(a){Ext.create(a)})}}),Ext.define("Melisa.core.ProfilePhone",{extend:"Ext.app.Profile",view:null,isActive:function(){return Ext.platformTags.phone||Ext.platformTags.modern},launch:function(){var a=this;Ext.require([a.view],function(){Ext.Viewport.add(Ext.create(a.view))})}}),Ext.define("Melisa.core.ProfileTablet",{extend:"Ext.app.Profile",view:null,css:null,isActive:function(){return Ext.platformTags.tablet},launch:function(){var a=this;Ext.require(["Melisa.override.Viewport","Melisa.override.Button","Melisa.override.List","Melisa.ux.util.CSS",a.view],function(){Melisa.ux.util.CSS.swapStyleSheet("tablet","/"+a.css+"/css/main-tablet.css"),Ext.Viewport.add(Ext.create(a.view))})}}),Ext.define("Melisa.core.module.Manager",{singleton:!0,requires:["Melisa.core.Base"],mixins:["Melisa.core.Base"],modules:{},unRegister:function(a){var b,c=this,d=c.modules[a];return d?(b=d.fireEvent("beforeclosemodule"),b===!1?(c.log("cancel un unregister"),!1):(c.log("module delete",a),delete c.modules[a],d.destroy(),c.log("module destroy",c.modules),!0)):void c.log("no exist module",c.modules)},get:function(a){var b=this,c=b.modules[a];return!!c&&c},register:function(a,b){var c,d=this;return a?"undefined"==typeof a.nameSpace?(d.log("no specific namespace module",a),!1):(c=d.modules[a.nameSpace])?(d.log("exist module return module",c),c):(Ext.platformTags.modern?Ext.Viewport.setMasked({xtype:"loadmask",message:"Abriendo módulo"}):Ext.Msg.wait("Abriendo módulo"),Ext.ClassManager.get(a.nameSpace)?(d.log("register module",a),c=d.modules[a.nameSpace]=Ext.create(a.nameSpace),c.setConfigModule(a),Ext.isFunction(b)&&b(c),Ext.platformTags.modern&&Ext.Viewport.setMasked(!1),c.initModule(),c):(d.log("no exist class, require",a.nameSpace),void Ext.require(a.nameSpace,function(){d.log("class loaded",a.nameSpace),d.register(a,b)},d))):(d.log("invalid config module"),!1)},launch:function(a,b){var c=this,d=c.register(a,b);return d?(c.log("module exist",d),d.getIsReady()?(Ext.isFunction(b)&&b(d),c.log("module reboot"),d.fireEvent("reboot",d),d):void c.log("module not is ready")):void c.log("class is loading or invalid",a)}}),Ext.define("Melisa.core.ViewController",{extend:"Ext.app.ViewController",requires:["Melisa.core.module.Manager"],mixins:Ext.platformTags.classic?["Melisa.core.Base"]:["Melisa.core.Base","Melisa.ux.Navigate"],config:{handlersClass:["Ext.menu.Item","Ext.Button","Ext.button.Button","Ext.form.field.Text","Ext.form.field.ComboBox","Melisa.view.desktop.ComboDefault"]},init:function(){var a=this,b=a.getView(),c=Ext.platformTags.modern?"painted":"render";b.on(c,a.onRender,a,{single:!0})},onRender:function(){},showError:function(a,b,c,d){Ext.Msg.alert(a,b,c,d)},activateMainModule:function(a){var b=this,c=b.getView(),d=c.getLastModule(),e={cancel:!1,lastModule:d};return b.log("activateMainModule",a,d),d?c.fireEvent("beforeactivatelastmodule",e)===!1||e.cancel?void b.log("cancel activate module"):void Ext.GlobalEvents.fireEvent("activatemodule",{},d):void console.log("no last module")},activateModule:function(a){Ext.GlobalEvents.fireEvent("activatemodule",{},a)},closeModule:function(a){var b=this;b.getView().setClosingModule(!0),b.activateMainModule(a)},moduleRun:function(a,b,c,d,e){var f,g=this,h=g.getHandlersClass(),i={single:!0},j=Ext.getClassName(a);console.log(j),h.indexOf(j)!==-1?(f=a,a=a.getMelisa()):"undefined"!=typeof a.getMelisa&&(f=a,a=a.getMelisa()),d&&(i.args=Ext.isArray(d)?d:[d]),Melisa.core.module.Manager.launch(a,Ext.bind(g.onLaunchModule,g,[{launcher:f,params:d,scope:e,callbackOnReady:Ext.isFunction(b)?b:Ext.emptyFn,callbackOnReboot:Ext.isFunction(c)?c:Ext.emptyFn}],0))},onLaunchModule:function(a,b){var c=this;b.getIsReady()?b.on("reboot",Ext.bind(c.onLaunchModuleReboot,c,[a],0),c,{single:!0}):b.on("ready",Ext.bind(c.onLaunchModuleReady,c,[a],0),c,{single:!0})},onLaunchModuleReboot:function(a,b){var c=this;console.log("onLaunchModuleReboot",b),c.fireModuleLoaded(a,b),c.onActivateModule(a,b)},onLaunchModuleReady:function(a,b){var c=this;console.log("onLaunchModuleReady",b),c.fireModuleLoaded(a,b),c.onActivateModule(a,b)},fireModuleLoaded:function(a,b){var c=this,d=c.getHandlersClass(),e=Ext.getClassName(a.launcher);c.log("fire module loaded",{options:a,module:b,classHandlers:d,className:e,view:c.getView()}),b.setLastModule(c.getView()),Ext.isFunction(a.callbackOnReady)&&Ext.callback(a.callbackOnReady,c,[b,a]),d.indexOf(e)!==-1?a.launcher.fireEvent("loaded",b,a):"undefined"!=typeof a.launcher.getMelisa&&a.launcher.fireEvent("loaded",b,a)},onActivateModule:function(a,b){var c=this;return c.log("onActivateModule",arguments),c.fireEvent("beforeactivatemodule",a,b)?void(b.getIsAutoShow()?Ext.GlobalEvents.fireEvent("activatemodule",a,b):c.log("no auto show module",a,b)):void c.log("cancel activate module",a,b)}}),Ext.define("Melisa.core.module.Create",{save:function(a,b){var c=this,d=c.getView(),e=c.getViewModel();c.submitForm(d,e,a,b)},submitForm:function(a,b,c,d){var e=this;return Ext.platformTags.modern||a.isValid()?void a.submit({url:Ext.platformTags.modern?a.getUrl():a.getForm().url,success:Ext.bind(e.onSuccessSubmit,e),failure:Ext.bind(e.onErrorSubmit,e),waitMsg:b.get("i18n.saving"),headers:{"X-CSRF-TOKEN":b.get("token")},params:c===!0?d:null}):(console.log("formulario invalido"),!1)},onSuccessSubmit:function(a){console.log("onSuccessSubmit");var b=this,c=b.getView();c.reset(),c.fireEvent("successsubmit",a)},onErrorSubmit:function(a,b){console.log("onErrorSubmit",arguments);var c=this,d=c.getView();d.fireEvent("errorsubmit",a,b)}}),Ext.define("Melisa.core.module.Assets",{singleton:!0,config:{queue:null,loading:!1,callback:null},load:function(a,b){var c=this,d=[];return Ext.each(a,function(a){2===a.idAssetType?Ext.util.CSS.swapStyleSheet(a.id,a.url):d.push(a)}),Ext.isFunction(b)&&c.setCallback(b),Ext.isEmpty(d)?c.callCallback():void c.createQueue().addAll(d)},callCallback:function(){var a=this,b=a.getCallback();b&&Ext.callback(b)},createQueue:function(){var a=this,b=a.getQueue();return b?b:(b=Ext.create("Ext.util.MixedCollection",{listeners:{add:a.onAddItemQueue,scope:a}}),a.setQueue(b),b)},onAddItemQueue:function(){var a=this;return a.getLoading()?void console.log("ignore load item queue"):(a.setLoading(!0),void a.nextLoadAsset())},nextLoadAsset:function(){var a=this,b=a.getQueue(),c=b.first();return c?void Ext.Loader.loadScript({url:c.url,onLoad:a.onLoadScript,scope:a}):void a.callCallback()},onLoadScript:function(a){var b=this,c=b.getQueue();c.removeAt(0),b.setLoading(!1),b.nextLoadAsset()}}),Ext.define("Melisa.core.Module",{requires:["Melisa.core.Base","Melisa.core.module.Manager","Melisa.core.module.Assets"],mixins:["Melisa.core.Base"],config:{configModule:{},initialized:!1,isReady:!1,lastModule:null,isAutoShow:!0,isModule:!0,closeDestroy:!1,closingModule:!1},initModule:function(){var a=this,b=a.getConfigModule();return a.log("init module",b),a.getInitialized()?void console.log("module initialized"):(a.setInitialized(!0),a.on("ready",a.onReady,a),("undefined"==typeof b.url||Ext.isEmpty(b.url))&&(a.log("disabled get remote config but no specific url config"),a.moduleRemoteConfig=!1),"undefined"==typeof a.moduleRemoteConfig||a.moduleRemoteConfig?(Ext.platformTags.modern||Ext.Msg.wait("Configurando módulo"),void Ext.Ajax.request({url:b.url,method:"GET",success:a.onSuccessGetConfigModule,failure:a.onFailureGetConfigModule,scope:a})):(a.log("disabled get remote config"),a.setIsReady(!0),a.on("reboot",a.onReboot,a),void a.fireEvent("ready",a,b)))},onSuccessGetConfigModule:function(a){var b=this,c=Ext.decode(a.responseText,!0);return b.log("success get config module",c),Ext.platformTags.modern||Ext.Msg.close(),c.success?c&&"undefined"!=typeof c.data?void(Ext.isArray(c.assets)?b.loadAsset(c):b.setModuleReady(c)):void b.fireEvent("errorgetconfig",a):void console.log("error get module",c)},setModuleReady:function(a){var b=this;b.log("set module ready",a),b.getViewModel().setData(a.data),b.setIsReady(!0),b.on("reboot",b.onReboot,b),b.fireEvent("ready",b,a)},loadAsset:function(a){var b=this;b.log("load assets",a),Ext.platformTags.modern?Ext.Viewport.setMasked({xtype:"loadmask",message:"Cargando archivos"}):Ext.Msg.wait("Cargando archivos"),Melisa.core.module.Assets.load(a.assets,Ext.bind(b.onLoadAssets,b,[a],0))},onLoadAssets:function(a){var b=this;b.log("assets loading",a),Ext.platformTags.modern?Ext.Viewport.setMasked(!1):Ext.Msg.close(),b.setModuleReady(a)},onFailureGetConfigModule:function(a){var b=Ext.decode(a.responseText,!0);Ext.platformTags.modern?Ext.Viewport.setMasked(!1):Ext.Msg.close(),console.log(b)},onReady:function(){var a=this;a.log("on ready"),a.redirectToModule()},redirectToModule:function(){var a,b=this,c=b.getViewModel(),d=c.get("route"),e=b.getController(),f=Ext.ClassManager.getName(b);return b.log("redirect module",{me:b,route:d,controller:e,token:f}),d&&e?void e.redirectTo(d):e?void e.redirectTo(f):(a=Ext.util.History.getToken()===f,void(a?Ext.app.route.Router.onStateChange(f):Ext.util.History.add(f)))},onReboot:function(){var a=this;a.log("reboot",arguments),Ext.platformTags.classic&&a.getIsAutoShow()&&(a.getEl().removeCls("x-hidden-offsets"),a.show()),a.redirectToModule()}}),Ext.define("Melisa.view.desktop.wrapper.window.Add",{extend:"Ext.window.Window",alias:"widget.wrapperWindowAdd",requires:["Melisa.core.Module"],mixins:["Melisa.core.Module"],layout:"fit",bodyPadding:0,modal:!0,bbar:{xtype:"toolbardefault"}}),Ext.define("Melisa.view.desktop.wrapper.window.View",{extend:"Melisa.view.desktop.wrapper.window.Add",alias:"widget.wrapperWindowView",requires:["Melisa.view.desktop.wrapper.window.Add"],bbar:null}),Ext.define("Melisa.view.desktop.wrapper.Default",{extend:"Ext.panel.Panel"}),Ext.define("Melisa.view.desktop.toolbar.Default",{extend:"Ext.toolbar.Toolbar",alias:"widget.toolbardefault",items:["->",{bind:{text:'{i18n.btnSave ? i18n.btnSave : "Guardar"}'},scale:"large",iconCls:"x-fa fa-save",listeners:{click:"save"}}]}),Ext.define("Melisa.view.desktop.ComboBoolean",{extend:"Ext.form.field.ComboBox",alias:"widget.comboboolean",displayField:"name",minChars:1,pageSize:null,forceSelection:!0,typeAhead:!0,store:Ext.create("Ext.data.Store",{fields:["id","name"],proxy:{type:"memory"},data:[{id:1,name:"Si"},{id:0,name:"No"}]})}),Ext.define("Melisa.view.desktop.ComboDefault",{extend:"Ext.form.field.ComboBox",alias:"widget.combodefault",displayField:"name",minChars:1,pageSize:null,forceSelection:!0,typeAhead:!0,store:Ext.create("Ext.data.Store",{fields:["id","name"],proxy:{type:"memory"}})}),Ext.define("Melisa.view.desktop.ComboSex",{extend:"Ext.form.field.ComboBox",alias:"widget.combosex",displayField:"name",minChars:1,pageSize:null,forceSelection:!0,typeAhead:!0,store:Ext.create("Ext.data.Store",{fields:["id","name"],proxy:{type:"memory"},data:[{id:1,name:"Masculino"},{id:0,name:"Femenino"}]})}),Ext.define("Melisa.core.Application",{extend:"Ext.app.Application",alternateClassName:["Melisa.App"],requires:Ext.platformTags.modern?["Melisa.override.field.Number","Melisa.override.field.Toggle","Melisa.override.field.TextArea","Melisa.override.field.Text","Melisa.override.field.Field","Melisa.override.form.Panel","Melisa.override.Button","Melisa.override.plugin.PullRefresh","Melisa.override.plugin.ListPaging","Melisa.override.ux.Iframe","Melisa.core.Logger","Melisa.core.AutoOpenModule","Melisa.core.ProfileDesktop","Melisa.core.ProfilePhone","Melisa.core.ViewController","Melisa.util.Format"]:["Melisa.override.menu.Item","Melisa.override.Button","Melisa.override.form.Panel","Melisa.override.form.field.Text","Melisa.override.form.field.ComboBox","Melisa.override.form.field.Checkbox","Melisa.override.form.field.DateField","Melisa.override.form.field.Number","Melisa.override.grid.column.Widget","Melisa.override.grid.column.Boolean","Melisa.util.Format","Melisa.override.ux.Iframe","Melisa.core.Logger","Melisa.core.AutoOpenModule","Melisa.core.ProfileDesktop","Melisa.core.ProfilePhone","Melisa.core.ViewController","Melisa.view.desktop.wrapper.Default","Melisa.view.desktop.toolbar.Default","Melisa.view.desktop.ComboBoolean","Melisa.view.desktop.ComboDefault","Melisa.view.desktop.ComboSex"],launch:function(){Ext.ariaWarn=Ext.emptyFn}});